{{ define "main" }}
<div class="container py-5">
  <div class="row justify-content-center">
    <div class="col-12 text-center mb-4">
      <h1 class="h2 m-0">{{ .Title }}</h1>
    </div>
  </div>

  <style>
    .sessions-list .session-card{background:#1b2635;border-radius:.75rem;padding:1.25rem 1.5rem;height:100%}
    .sessions-list .session-title{font-weight:700}
    .sessions-list .session-speaker{font-weight:700}
    .sessions-list .badge{border:0;background:rgba(255,255,255,.12);color:#fff;margin-right:.35rem}
    .sessions-list .badge.level{background:linear-gradient(90deg,#6c7a89,#93a1ad)}
    .sessions-list .badge.level.l100{background:linear-gradient(90deg,#16a34a,#22c55e)}
    .sessions-list .badge.level.l200{background:linear-gradient(90deg,#2563eb,#60a5fa)}
    .sessions-list .badge.level.l300{background:linear-gradient(90deg,#6f42c1,#a78bfa)}
    .sessions-list .badge.level.l400{background:linear-gradient(90deg,#ef4444,#f97316)}
    .sessions-list .badge.format{background:linear-gradient(90deg,#ff9900,#6f42c1)}
    .sessions-list .session-meta{color:rgba(255,255,255,.75)}
    .sessions-list a.card-link{text-decoration:none;color:inherit;display:block}
    .sessions-list a.card-link:hover .session-title{text-decoration:underline}
    /* avatars consistent with speakers page */
    /* unified circular avatar frame (same as speakers page, smaller) */
    .sessions-list .avatar-frame{width:56px;height:56px;border-radius:9999px;background:#17202c;overflow:hidden;display:inline-block;border:2px solid #1b2635}
    .sessions-list .avatar-frame img{width:100%;height:100%;object-fit:cover;object-position:50% 25%;display:block}
    .sessions-list .avatar-initials{width:44px;height:44px;border-radius:9999px;display:inline-flex;align-items:center;justify-content:center;font-weight:700;color:#9fb3c8;background:#17202c;border:2px solid #1b2635}
    .sessions-list .avatar-group{display:inline-flex;align-items:center}
    .sessions-list .avatar-stack>span{margin-left:-10px;position:relative}
  </style>

  {{- $roomSlug := .File.TranslationBaseName -}}
  {{- $sessions := where site.RegularPages "Section" "sessions" -}}
  {{- $sessions = where $sessions ".Params.room" "==" $roomSlug -}}
  {{- $sessions = sort $sessions ".Date" "asc" -}}

  <div class="row g-3 sessions-list">
    {{- range $s := $sessions -}}
      {{- $cardTitle := default $s.Title $s.Params.summary -}}
      {{- $format := $s.Params.format -}}
      {{- $lvlStr := printf "%v" $s.Params.level -}}
      {{- $speakerSlugs := $s.Params.speakers | default (slice) -}}
      {{- $speakerPages := slice -}}
      {{- $allSpeakers := where site.Pages "Section" "speakers" -}}
      {{- range $speakerSlugs }}
        {{- $slug := . -}}
        {{- $fromGetPage := site.GetPage (printf "speakers/%s" $slug) -}}
        {{- $fallback := index (where $allSpeakers ".File.TranslationBaseName" $slug) 0 -}}
        {{- $p := or $fromGetPage $fallback -}}
        {{- if $p }}{{- $speakerPages = $speakerPages | append $p -}}{{- end -}}
      {{- end -}}

      <div class="col-12">
        <a class="card-link" href="{{ $s.RelPermalink }}">
          <div class="session-card">
            <div class="row g-3 align-items-center">
              <div class="col-12 col-md-9">
                <div class="session-title h5 m-0">{{ $cardTitle }}</div>
                <div class="mt-2">
                  {{- with $format -}}<span class="badge format">{{ . }}</span>{{- end -}}
                  {{- if $lvlStr }}<span class="badge level {{ cond (eq $lvlStr "100") "l100" (cond (eq $lvlStr "200") "l200" (cond (eq $lvlStr "300") "l300" (cond (eq $lvlStr "400") "l400" ""))) }}">Level {{ $lvlStr }}</span>{{- end -}}
                </div>
                {{- if $s.Params.summary -}}
                  <div class="mt-3 session-meta">{{ $s.Params.summary }}</div>
                {{- else if $s.Content -}}
                  <div class="mt-3 session-meta">{{ $s.Content | plainify | truncate 360 }}</div>
                {{- end -}}
              </div>

              <div class="col-12 col-md-3 text-md-end">
                {{- range $sp := $speakerPages }}
                  {{- $photo := or ($sp.Resources.GetMatch "img/photo*") ($sp.Resources.GetMatch "img/*") -}}
                  {{- if not $photo -}}
                    {{- $imgs := $sp.Resources.ByType "image" -}}
                    {{- if gt (len $imgs) 0 -}}{{- $photo = index $imgs 0 -}}{{- end -}}
                  {{- end -}}
                  <div class="d-flex align-items-center justify-content-md-end gap-2 mb-2">
                    {{- if $photo -}}
                      <a href="{{ $sp.RelPermalink }}" class="text-reset text-decoration-none"><span class="avatar-frame"><img src="{{ $photo.RelPermalink }}" alt="{{ $sp.Title }}" style="object-position:50% {{ or $sp.Params.focusY "25%" }};"></span></a>
                    {{- else -}}
                      <a href="{{ $sp.RelPermalink }}" class="text-reset"><span class="avatar-initials">{{ (substr $sp.Title 0 1) | upper }}</span></a>
                    {{- end -}}
                    <a href="{{ $sp.RelPermalink }}" class="text-reset">{{ $sp.Title }}</a>
                  </div>
                {{- end -}}
              </div>
            </div>
          </div>
        </a>
      </div>
    {{- end -}}
  </div>
</div>
{{ end }}


